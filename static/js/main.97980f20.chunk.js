(this["webpackJsonpreact-tutorial"]=this["webpackJsonpreact-tutorial"]||[]).push([[0],{35:function(e,t,n){},36:function(e,t,n){},37:function(e,t,n){},39:function(e,t,n){},51:function(e,t,n){},52:function(e,t,n){"use strict";n.r(t);var r=n(25),a=n.n(r),c=(n(35),n(12)),s=(n(36),n(16)),i=n(30),o=n(26),u=n.n(o),p=(n(37),n(2)),l=["text","noOverlay","className"];var h,f=function(e){var t=e.text,n=e.noOverlay,r=e.className,a=Object(i.a)(e,l),c=u()("Spinner",n&&"Spinner--noOverlay",r);return Object(p.jsxs)("div",Object(s.a)(Object(s.a)({},a),{},{className:c,children:[Object(p.jsx)("div",{className:"Spinner-spinner",children:Object(p.jsx)("svg",{viewBox:"0 0 64 64",children:Object(p.jsx)("circle",{transform:"translate(32,32)",r:"26"})})}),t?Object(p.jsx)("div",{className:"Spinner-content",children:t}):null]}))},b=n(0),m=n(9),d=n(10),v=n(11),y=n(19),j=n(17),O=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:function(){return window.localStorage};Object(d.a)(this,e),this.storage=void 0,this.storage=t()}return Object(v.a)(e,[{key:"get",value:function(e){return this.storage.getItem(e)}},{key:"set",value:function(e,t){this.storage.setItem(e,t)}},{key:"clearItem",value:function(e){this.storage.removeItem(e)}},{key:"clearItems",value:function(e){var t=this;e.forEach((function(e){return t.clearItem(e)}))}}]),e}();!function(e){e.ALL_TOKENS="all_tokens"}(h||(h={}));var g=function(e){Object(y.a)(n,e);var t=Object(j.a)(n);function n(){return Object(d.a)(this,n),t.call(this)}return Object(v.a)(n,[{key:"setAllTokens",value:function(e){this.set(h.ALL_TOKENS,JSON.stringify(e))}},{key:"getAllTokens",value:function(){var e=this.get(h.ALL_TOKENS);return e?JSON.parse(e):null}},{key:"clear",value:function(){this.clearItems([h.ALL_TOKENS])}}],[{key:"getInstance",value:function(){return this.instance||(this.instance=new n),this.instance}}]),n}(O);g.instance=void 0;n(39);var x=function(){var e=g.getInstance().getAllTokens();return Object(p.jsxs)("div",{className:"navbar",children:[Object(p.jsx)(m.b,{to:"/",children:"Home"}),!e&&Object(p.jsx)(m.b,{to:"/login",children:"Login"}),e&&Object(p.jsx)(m.b,{to:"/vendors",children:"Vendors"})]})},k=n(4),w=n(1),I=n.n(w),S=n(3),D=n(29),T=n.n(D),R="07aedeb85a0441668d6755de78407538",M="38988",E="dBElXQcNpvR84zmqMTI0gPwo022Sdu.EXZhrxy.HVPo",_="https://mlsof21.github.io/d2-vendor-pages/%23/callback",L="https://www.bungie.net/Platform";function A(){return N.apply(this,arguments)}function N(){return(N=Object(S.a)(I.a.mark((function e(){var t;return I.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if((t=g.getInstance().getAllTokens())||g.getInstance().clear(),!(t&&!G(t.accessToken))){e.next=5;break}return e.abrupt("return",t);case 5:if(t&&!G(t.refreshToken)||console.log("We need to fetch a new token here"),e.prev=7,!t){e.next=12;break}return e.next=11,U(t.refreshToken);case 11:return e.abrupt("return",e.sent);case 12:throw new Error;case 15:throw e.prev=15,e.t0=e.catch(7),new Error("I dunno");case 18:case"end":return e.stop()}}),e,null,[[7,15]])})))).apply(this,arguments)}function F(e){return P.apply(this,arguments)}function P(){return(P=Object(S.a)(I.a.mark((function e(t){var n,r,a,c;return I.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,A();case 2:if(n=e.sent){e.next=6;break}throw console.error("We need a new token"),new Error("Some token error");case 6:if(r={authorization:"Bearer ".concat(n.accessToken.value),"x-api-key":R},a=t.url,t.params){for(c in t.params)"undefined"===typeof t.params[c]&&delete t.params[c];a="".concat(a,"?").concat(new URLSearchParams(t.params).toString())}return console.log("Creating http client",{token:n}),console.log("Fetching from",t.url,"with headers",r,"body",t.body,"params",t.params),e.abrupt("return",fetch(a,{method:t.method,body:t.body,headers:r}).then((function(e){return e.json()})));case 12:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function C(e){return B.apply(this,arguments)}function B(){return(B=Object(S.a)(I.a.mark((function e(t){return I.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",fetch(t.url,{method:t.method,body:t.body}).then((function(e){return e.json()})));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function H(e){var t=new URLSearchParams({grant_type:"authorization_code",code:e,client_id:M,client_secret:E});return fetch("".concat(L,"/app/oauth/token/"),{method:"POST",body:t}).then((function(e){return e.json()})).then(z).then((function(e){return g.getInstance().setAllTokens(e)}))}function z(e){if(null===e||void 0===e?void 0:e.access_token){var t=e,n=Date.now(),r={accessToken:{value:t.access_token,expires:t.expires_in,name:"access",inception:n},bungieMembershipId:t.membership_id};return t.refresh_token&&(r.refreshToken={value:t.refresh_token,expires:t.refresh_expires_in,name:"refresh",inception:n}),r}throw new Error("No tokens")}function U(e){var t=new URLSearchParams({grant_type:"refresh_token",refresh_token:e.value,client_id:M,client_secret:E});return Promise.resolve(fetch("".concat(L,"/app/oauth/token/"),{method:"POST",body:t,headers:{"Content-Type":"application/x-www-form-urlencoded"}}).then((function(e){return e.ok?e.json():Promise.reject(e)})).then(z).then((function(e){return g.getInstance().setAllTokens(e),e})))}function G(e){if(!e)return!0;var t=1e3*e.expires+e.inception;return Date.now()>t}n(51);var J=function(){var e=Object(k.g)();console.log("Using redirect",_);var t=function(){var t=Object(S.a)(I.a.mark((function t(n){var r;return I.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=n.code,console.log({code:r}),t.next=4,H(r);case 4:e.push("/");case 5:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}();return Object(p.jsx)(T.a,{authorizationUrl:"https://www.bungie.net/en/Oauth/Authorize",responseType:"code",clientId:M,redirectUri:_,onSuccess:t,onFailure:function(e){return console.log(e)},buttonText:"Login with Bungie.net",className:"loginButton"})};var K=function(){var e=new URLSearchParams(Object(k.h)().search).get("code");return Object(p.jsx)(p.Fragment,{children:!e&&Object(p.jsx)(p.Fragment,{children:e})})},V=n(54),W=n(55);function X(e){return Z.apply(this,arguments)}function Z(){return(Z=Object(S.a)(I.a.mark((function e(t){var n,r,a,c,s,i;return I.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("Fetching membership info",t),e.next=3,Object(V.b)(F,{membershipId:t,membershipType:254,getAllMemberships:!0}).then((function(e){return e.Response}));case 3:return n=e.sent,r=n.profiles[0].membershipId,a=n.profiles[0].membershipType,e.next=8,Object(V.c)(F,{destinyMembershipId:r,components:[200],membershipType:a}).then((function(e){return e.Response}));case 8:return c=e.sent,s=q(c),i={bungieMembershipId:t,destinyMembershipId:r,membershipType:a,hunterId:s.hunter,titanId:s.titan,warlockId:s.warlock},e.abrupt("return",i);case 12:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function q(e){var t=null,n=null,r=null;if(e.characters.data){var a=e.characters.data;Object.keys(e.characters.data).forEach((function(e){switch(a[e].classType){case 0:n=e;break;case 1:t=e;break;case 2:r=e;break;default:throw new Error("Unknown class type")}}))}return{hunter:t,titan:n,warlock:r}}function Q(){return Y.apply(this,arguments)}function Y(){return(Y=Object(S.a)(I.a.mark((function e(){var t;return I.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(V.a)(C);case 2:return t=e.sent,e.abrupt("return",t.Response);case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function $(){return ee.apply(this,arguments)}function ee(){return(ee=Object(S.a)(I.a.mark((function e(){var t,n;return I.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Q();case 2:return t=e.sent,e.next=5,Object(W.a)(C,{destinyManifest:t,language:"en",tableNames:["DestinyInventoryItemDefinition","DestinyStatDefinition"]});case 5:return n=e.sent,console.log({manifestSlice:n}),e.abrupt("return",n);case 8:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function te(e){var t=e.hunterId,n=e.titanId,r=e.warlockId,a=[];return n&&a.push({id:n,classType:0}),t&&a.push({id:t,classType:1}),r&&a.push({id:r,classType:2}),a}function ne(e){return re.apply(this,arguments)}function re(){return re=Object(S.a)(I.a.mark((function e(t){var n,r;return I.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=te(t),console.time("getVendorsForAllCharacters"),console.timeLog("getVendorsForAllCharacters"),r={},e.next=6,Promise.all(n.map(function(){var e=Object(S.a)(I.a.mark((function e(n){var a,c,s;return I.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=n.id,c=n.classType,e.next=3,ae(a,t.destinyMembershipId,t.membershipType);case 3:s=e.sent,r[c]=s;case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 6:return console.timeEnd("getVendorsForAllCharacters"),e.abrupt("return",r);case 8:case"end":return e.stop()}}),e)}))),re.apply(this,arguments)}function ae(e,t,n){return ce.apply(this,arguments)}function ce(){return(ce=Object(S.a)(I.a.mark((function e(t,n,r){var a;return I.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(V.d)(F,{characterId:t,components:[304,402],destinyMembershipId:n,membershipType:r});case 2:return a=e.sent,e.abrupt("return",a.Response);case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var se,ie=n(23);function oe(e){return ue.apply(this,arguments)}function ue(){return(ue=Object(S.a)(I.a.mark((function e(t){var n;return I.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(ie.a)("destiny2-store",1,{upgrade:function(e){e.createObjectStore("d2")}});case 2:return n=e.sent,e.abrupt("return",n.get("d2",t));case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function pe(e,t){return le.apply(this,arguments)}function le(){return(le=Object(S.a)(I.a.mark((function e(t,n){var r;return I.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(ie.a)("destiny2-store",1,{upgrade:function(e){e.createObjectStore("d2")}});case 2:return r=e.sent,e.abrupt("return",r.put("d2",n,t));case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function he(e){return fe.apply(this,arguments)}function fe(){return(fe=Object(S.a)(I.a.mark((function e(t){return I.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,pe("DestinyInventoryItemDefinition",t.DestinyInventoryItemDefinition);case 2:return e.next=4,pe("DestinyStatDefinition",t.DestinyStatDefinition);case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function be(){return me.apply(this,arguments)}function me(){return(me=Object(S.a)(I.a.mark((function e(){return I.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,oe("DestinyStatDefinition");case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function de(){return ve.apply(this,arguments)}function ve(){return(ve=Object(S.a)(I.a.mark((function e(){return I.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,oe("DestinyInventoryItemDefinition");case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})))).apply(this,arguments)}!function(e){e.MEMBERSHIP_INFO="membership_info"}(se||(se={}));var ye=function(e){Object(y.a)(n,e);var t=Object(j.a)(n);function n(){return Object(d.a)(this,n),t.call(this)}return Object(v.a)(n,[{key:"getMembershipInfo",value:function(){var e=this.get(se.MEMBERSHIP_INFO);if(e)return JSON.parse(e)}},{key:"setMembershipInfo",value:function(e){this.set(se.MEMBERSHIP_INFO,e)}}],[{key:"getInstance",value:function(){return this.instance||(this.instance=new n),this.instance}}]),n}(O);ye.instance=void 0;var je=function(){var e=Object(k.g)(),t=Object(b.useState)(!0),n=Object(c.a)(t,2),r=n[0],a=n[1],s=g.getInstance(),i=ye.getInstance(),o=s.getAllTokens(),u="";if(!o)return console.info("Redirecting to Login"),e.push("/Login"),Object(p.jsx)(p.Fragment,{});o&&(u=null===o||void 0===o?void 0:o.bungieMembershipId);var l=i.getMembershipInfo();function h(){return(h=Object(S.a)(I.a.mark((function e(){var t,n,r;return I.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,be();case 2:return t=e.sent,e.next=5,de();case 5:if(n=e.sent,t&&n){e.next=18;break}return e.next=9,$();case 9:return r=e.sent,e.next=12,he(r);case 12:return e.next=14,be();case 14:return t=e.sent,e.next=17,de();case 17:n=e.sent;case 18:if(l){e.next=23;break}return e.next=21,X(u);case 21:l=e.sent,i.setMembershipInfo(JSON.stringify(l));case 23:a(!1);case 24:case"end":return e.stop()}}),e)})))).apply(this,arguments)}return Object(b.useEffect)((function(){!function(){h.apply(this,arguments)}()}),[]),r?Object(p.jsx)(f,{text:"Loading Destiny manifest"}):Object(p.jsx)(p.Fragment,{children:"This is the home page"})},Oe={1:"Hunter",0:"Titan",2:"Warlock"},ge={350061650:"Ada-1",396892126:"Devrim",248695599:"Drifter",1576276905:"Failsafe",3603221665:"Shaxx",69482069:"Zavala",2190858386:"Xur"},xe={2996146975:"Mobility",392767087:"Resilience",1943323491:"Recovery",1735777505:"Discipline",144602215:"Intellect",4244567218:"Strength"},ke={26:"Helmet",27:"Gauntlets",28:"Chest Armor",29:"Leg Armor"},we=n(15);function Ie(e){return Se.apply(this,arguments)}function Se(){return(Se=Object(S.a)(I.a.mark((function e(t){var n,r,a,c,s,i,o,u,p,l;return I.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n={},r=Object.keys(t).map((function(e){return parseInt(e)})),console.time("getDestinyInventoryItemDefinitionFromStore"),console.timeLog("getDestinyInventoryItemDefinitionFromStore"),e.next=6,de();case 6:a=e.sent,console.timeEnd("getDestinyInventoryItemDefinitionFromStore"),console.time("getScorableItems"),console.timeLog("getScorableItems"),c=Object(we.a)(r),e.prev=11,c.s();case 13:if((s=c.n()).done){e.next=37;break}i=s.value,n[i]={},o=Object.keys(ge).map((function(e){return parseInt(e)})),u=Object(we.a)(o),e.prev=18,u.s();case 20:if((p=u.n()).done){e.next=27;break}return l=p.value,e.next=24,Re(t[i],l,a);case 24:n[i][l]=e.sent;case 25:e.next=20;break;case 27:e.next=32;break;case 29:e.prev=29,e.t0=e.catch(18),u.e(e.t0);case 32:return e.prev=32,u.f(),e.finish(32);case 35:e.next=13;break;case 37:e.next=42;break;case 39:e.prev=39,e.t1=e.catch(11),c.e(e.t1);case 42:return e.prev=42,c.f(),e.finish(42);case 45:return console.timeEnd("getScorableItems"),e.abrupt("return",n);case 47:case"end":return e.stop()}}),e,null,[[11,39,42,45],[18,29,32,35]])})))).apply(this,arguments)}var De=function e(t){Object(d.a)(this,e),this.Mobility=0,this.Resilience=0,this.Recovery=0,this.Discipline=0,this.Intellect=0,this.Strength=0,Object.assign(this,t)},Te=function(){function e(t){Object(d.a)(this,e),this.Mobility=0,this.Resilience=0,this.Recovery=0,this.Discipline=0,this.Intellect=0,this.Strength=0,Object.assign(this,t)}return Object(v.a)(e,[{key:"getSortedSubGroup1",value:function(){return[this.Mobility,this.Resilience,this.Recovery].sort((function(e,t){return t-e}))}},{key:"getSortedSubGroup2",value:function(){return[this.Discipline,this.Intellect,this.Strength].sort((function(e,t){return t-e}))}}]),e}();function Re(e,t,n){return Me.apply(this,arguments)}function Me(){return(Me=Object(S.a)(I.a.mark((function e(t,n,r){var a,c,s,i,o,u,p,l,h;return I.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a={},console.time("getArmor ".concat(n)),console.timeLog("getArmor ".concat(n)),t.sales.data){c=Object.keys(t.sales.data[n].saleItems).map((function(e){return parseInt(e)})),s=t.sales.data[n].saleItems,i=Object(we.a)(c);try{for(i.s();!(o=i.n()).done;)u=o.value,p=s[u].itemHash,l=r[p].itemSubType,h=r[p].summaryItemHash,Ee(l)&&715326750!==h&&(a[l]={itemHash:p,saleKey:u,armorType:ke[l]})}catch(f){i.e(f)}finally{i.f()}}return console.timeEnd("getArmor ".concat(n)),e.abrupt("return",a);case 6:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Ee(e){return Object.keys(ke).map((function(e){return parseInt(e)})).includes(e)}function _e(e,t){return Le.apply(this,arguments)}function Le(){return(Le=Object(S.a)(I.a.mark((function e(t,n){var r,a,c,s,i,o;return I.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(r in t)for(a in t[r])for(c in t[r][a])n[r].itemComponents[a].stats.data&&(s=t[r][a][c].saleKey,i=n[r].itemComponents[a].stats.data[s],t[r][a][c].stats=Ae(i.stats),o=Ne(t[r][a][c].stats,parseInt(r)),t[r][a][c].rawScore=o.rawScore,t[r][a][c].normalizedScore=o.normalizedScore);return e.abrupt("return",t);case 2:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Ae(e){var t=new De;for(var n in e)switch(xe[n]){case"Mobility":t.Mobility=e[n].value;break;case"Resilience":t.Resilience=e[n].value;break;case"Recovery":t.Recovery=e[n].value;break;case"Discipline":t.Discipline=e[n].value;break;case"Intellect":t.Intellect=e[n].value;break;case"Strength":t.Strength=e[n].value;break;default:throw new Error("No idea what stat this is")}return t}function Ne(e,t){var n,r,a=function(e){switch(e){case 0:return new Te({Recovery:3,Discipline:2,Resilience:1});case 1:return new Te({Recovery:3,Discipline:2,Mobility:1});case 2:return new Te({Recovery:3,Discipline:3})}return new Te}(t),c=function(e,t){var n=0;return n+=e.Mobility*t.Mobility,n+=e.Resilience*t.Resilience,n+=e.Recovery*t.Recovery,n+=e.Discipline*t.Discipline,n+=e.Intellect*t.Intellect,n+=e.Strength*t.Strength}(e,a);return{rawScore:c,normalizedScore:(n=c,r=function(e){var t=30,n=2,r=e.getSortedSubGroup1(),a=e.getSortedSubGroup2();return t*(r[0]+a[0])+n*(r[1]+r[2]+a[1]+a[2])}(a),Math.round(n/r*100))}}var Fe=function(){var e=Object(b.useState)(!0),t=Object(c.a)(e,2),n=t[0],r=t[1],a=Object(b.useState)("Fetching Vendor inventory"),s=Object(c.a)(a,2),i=s[0],o=s[1],u=Object(b.useState)(),l=Object(c.a)(u,2),h=l[0],m=l[1],d=ye.getInstance().getMembershipInfo();function v(){return(v=Object(S.a)(I.a.mark((function e(){var t,n,a;return I.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!d){e.next=13;break}return e.next=3,ne(d);case 3:return t=e.sent,o("Getting scorable armor"),e.next=7,Ie(t);case 7:return n=e.sent,o("Scoring armor"),e.next=11,_e(n,t);case 11:a=e.sent,m(a);case 13:r(!1);case 14:case"end":return e.stop()}}),e)})))).apply(this,arguments)}return Object(b.useEffect)((function(){!function(){v.apply(this,arguments)}()}),[]),Object(p.jsxs)("div",{children:[n&&Object(p.jsx)(f,{text:i,noOverlay:!0}),h&&Object.keys(h).map((function(e){return parseInt(e)})).map((function(e){return Object(p.jsxs)("table",{children:[Object(p.jsxs)("tr",{children:[Object(p.jsx)("th",{children:Oe[e]}),Object.keys(ge).map((function(e){return parseInt(e)})).map((function(e){return Object(p.jsx)("th",{children:ge[e]},e)}))]}),Object.keys(ke).map((function(e){return parseInt(e)})).map((function(t){return Object(p.jsxs)("tr",{children:[Object(p.jsx)("th",{scope:"row",children:ke[t]}),Object.keys(ge).map((function(e){return parseInt(e)})).map((function(n){return Object(p.jsx)("td",{children:h[e][n][t].normalizedScore},n)}))]},t)}))]},e)}))]})};var Pe=function(){var e=Object(b.useState)(!1),t=Object(c.a)(e,2),n=t[0];return t[1],Object(p.jsxs)("div",{className:"App",children:[Object(p.jsx)(x,{}),Object(p.jsxs)(k.d,{children:[Object(p.jsx)(k.b,{exact:!0,path:"/login",component:J}),Object(p.jsx)(k.b,{exact:!0,path:"/vendors",component:Fe}),Object(p.jsx)(k.b,{exact:!0,path:"/callback",component:K}),Object(p.jsx)(k.b,{exact:!0,path:"/",component:je}),Object(p.jsx)(k.a,{to:"/"})]}),n&&Object(p.jsx)(f,{text:"Loading Destiny manifest",noOverlay:!1})]})},Ce=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,56)).then((function(t){var n=t.getCLS,r=t.getFID,a=t.getFCP,c=t.getLCP,s=t.getTTFB;n(e),r(e),a(e),c(e),s(e)}))};a.a.render(Object(p.jsx)(m.a,{children:Object(p.jsx)(Pe,{})}),document.getElementById("root")),Ce()}},[[52,1,2]]]);
//# sourceMappingURL=main.97980f20.chunk.js.map